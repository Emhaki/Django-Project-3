{% extends 'base.html' %}
{% load static %}

{% load django_bootstrap5 %}
{% block content %}
<div class="login-frame">
  <div class="login-frame__form">
    <img class="login-frame__form__img" src="{% static 'images/nes_orange.png' %}" alt="">
    <form id="login-form">
      {% csrf_token %}
      <input class="login-frame__form__id" type="text" name="username" placeholder="아이디를 입력해주세요.">
      <input class="login-frame__form__password" type="password" name="password" placeholder="비밀번호를 입력해주세요.">
      <button class="login-frame__form__logbtn">로그인</button>
    </form>
    <a href="{% url 'accounts:kakao' %}">
      <button class="login-frame__form__googlebtn">🍳 CONTINUE WITH KAKAO</button>
    </a>
    <div class="login-frame__form__detail">
      <div id="find-btn" class="login-frame_-form__detail__find">
        <a href="">아이디 찾기</a>
        |
        <a href="">비밀번호 찾기</a>
      </div>
      <div class="login-frame__form__detail__signup">
        <a href="{% url 'accounts:signup'%}">회원가입</a>
      </div>
    </div>
  </div>
</div>
<script>
  const loginForm = document.querySelector("#login-form");
  loginForm.addEventListener("submit", function (event) {
    event.preventDefault();
    axios({
      method: "post",
      url: `/accounts/login/`,
      data: new FormData(loginForm)
    })
      .then(response => {
        let msg = response.data.errorMsg;
        if (msg) {
          if (msg === "잘못된 아이디 혹은 패스워드 입니다.") {
            let titleText = "잘못된 입력입니다."
            let iconText = "error"
            swal.fire({
              backdrop: "rgba(255,255,255,0.5)",
              confirmButtonColor: '#203e96',
              confirmButtonText: '닫기',
              title: titleText,
              text: msg,
              icon: iconText,
            });
          } else if (msg === "존재하지 않는 회원입니다.") {
            let titleText = "정보를 찾을 수 없습니다."
            let iconText = "question"
            swal.fire({
              backdrop: "rgba(255,255,255,0.5)",
              confirmButtonColor: '#203e96',
              confirmButtonText: '닫기',
              title: titleText,
              text: msg,
              icon: iconText,
            });
          };
          loginForm.reset();
        } else {
          window.location.href = "{% url 'articles:ticket_machine' %}";
        };
      });
  });
</script>
<script>
  const findBtn = document.querySelector("#find-btn");
  for (i = 0; i < findBtn.childNodes.length; i++) {
    if (findBtn.childNodes[i].nodeName == "A") {
      const aTag = findBtn.childNodes[i];
      aTag.addEventListener("click", function (event) {
        event.preventDefault();
        Swal.fire({
          backdrop: "rgba(255,255,255,0.5)",
          confirmButtonColor: '#203e96',
          confirmButtonText: '닫기',
          icon: 'warning',
          title: '점검중',
          text: '현재 점검중인 기능입니다.',
          footer: `<a href="{% url 'questions:index' %}" style="text-decoration: none;">회원정보 관련 문의는 여기서 해주세요!</a>`,
        })
      });
    };
  };
</script>
{% endblock content %}